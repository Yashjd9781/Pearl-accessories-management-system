
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
          integrity="sha512-PgQMlq+nqFLV4ylk1gwUOgm6CtIIXkKwaIHp/PAIWHzig/lKZSEGKEysh0TCVbHJXCLN7WetD8TFecIky75ZfQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="profile_page.css">
    <title>profile</title>
    <style>
        .error {
            color: red;
        }

        .bg-right {
            margin-top: 5%;
        }

        .container-fluid {
            margin-bottom: 5%;
        }
    </style>
</head>

<body class="bg-right">
    <div class="container-fluid mt-5">
        <div class="row">
            <div class="col-md-10 col-11 mx-auto">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/app/IndexView">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">User</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Profile settings</li>
                    </ol>
                </nav>
                <div class="row">
                    <div class="col-lg-3 col-md-4 d-md-block">
                        <div class="card bg-common card-left">
                            <div class="card-body">
                                <nav class="nav d-md-block d-none">
                                    <a data-toggle="tab" class="nav-link active" aria-current="page" href="/app/ProfileView"><i class="fas fa-user"></i> Profile</a>

       

                                    <a data-toggle="tab" class="nav-link" href="/app/Change_Password"><i class="fas fa-lock"></i> Change password</a>
                                    <a data-toggle="tab" class="nav-link" href="/app/logout"><i class="fas fa-unlock"></i> Logout</a>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8 col-md-9">
                        <div class="card">
                            <div class="card-header border-bottom mb-3 d-md-none ">
                                <ul class="nav nav-tabs card-header-tabs nav-fill ">
                                    <li class="nav-item">
                                        <a data-toggle="tab" class="nav-link active" href="/app/ProfileView"><i class="fas fa-user"></i></a>
                                    </li>
                                 

                                    <li class="nav-item">
                                        <a data-toggle="tab" class="nav-link " href="/app/Change_Password"><i class="fas fa-lock"></i></a>
                                    </li>
                                    <li class="nav-item">
                                        <a data-toggle="tab" class="nav-link " href="/app/logout"><i class="fas fa-unlock"></i></a>
                                    </li>
                                </ul>
                            </div>
                            <!-- user-profile  -->
                            <div class="card-body tab-content ">
                                <div class="tab-pane active" id="Profile">

                                    <h6>YOUR PROFILE INFORMATION</h6>
                                    <hr>

                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">FirstName</label>

                                        <input type="text" id="fname" class="form-control" value="" name="fname"
                                               placeholder="FirstName"> <small class="form-text error">
                                            <div class="validation-message" style="color: red;" id="valid_fname"></div>

                                        </small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">LastName</label>
                                        <input type="text" id="lname" class="form-control" name="lname" value=""
                                               placeholder="LastName"> <small class="form-text error">
                                            <div class="validation-message" style="color: red;" id="valid_lname"></div>
                                        </small>
                                    </div>
                                    <div class="mb-2">
                                        <label for="exampleFormControlInput1" class="form-label">Email</label>
                                        <input type="text" class="form-control" value="" name="email" id="email"
                                               placeholder="xyz@gmail.com" disabled> <small class="form-text error">
                                            <div class="validation-message" style="color: red;" id="valid_email"></div>

                                        </small>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <label class="col-md-4 col-lg-3 col-form-label">Gender</label><br> <div class="validation-message" style="color: red;" id="valid_gender"></div>
                                        <div class="">
                                            <br>
                                            <label>
                                                <input type="radio" id="male" name="gender" value="Male"> Male
                                            </label>
                                            <label>
                                                <input type="radio" id="female" name="gender" value="Female"> Female
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <label for="exampleFormControlInput1" class="form-label">Contact</label>
                                        <input type="text" class="form-control" name="contact" id="contact" value=""
                                               placeholder="contact number"> <small class="form-text  error">
                                            <div class="validation-message" style="color: red;" id="valid_contact"></div>
                                        </small>
                                    </div>
                                    <div class="mb-2">
                                        <label for="exampleFormControlTextarea1" class="form-label">
                                            Address
                                        </label>
                                        <textarea class="form-control" name="address" id="address"
                                                  value="" rows="2"></textarea>

                                        <small class="form-text error">
                                            <div class="validation-message" style="color: red;" id="valid_address"></div>
                                        </small>
                                    </div>
                                    <div class="mb-2">
                                        <label for="exampleFormControlTextarea1" class="form-label">
                                            Shipping Address
                                        </label>
                                        <textarea class="form-control" name="shpping_address" id="shipping_address" value=""
                                                  rows="2"></textarea>

                                        <small class="form-text  error">
                                            <div class="validation-message" style="color: red;" id="valid_shipping_address"></div>
                                        </small>
                                    </div>
                                    <br>
                                    <button type="button" onclick="updateProfile()" class="btn btn-primary sm-btn">Update Profile</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>





    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


    <script>

        $(document).ready(function () {
            fetchUserProfile();
        });
        function updateProfile() {
            // Get input values
            var lname = $("#lname").val();
            var fname = $("#fname").val();
            var email = $("#email").val(); // Added missing email field
            var contact = $("#contact").val();
            var dob = $("#dob").val();
            var address = $("#address").val();
            var shipping_address = $("#shipping_address").val();
            var gender = $("input[name='gender']:checked").val();

            var nameRegex = /^[a-zA-Z]+$/;
            if (fname === '' || !nameRegex.test(fname)) {
                $("#valid_fname").text("Please enter a valid first name");
                console.log("first Name is empty ");
                return;
            }
            if (lname === '' || !nameRegex.test(lname)) {
                $("#valid_lname").text("Please enter a valid last name");
                console.log("last Name is empty ");
                return;
            }

           
            if (!gender) {
                $("#valid_gender").text("Please select your gender.");
                console.log("gender is empty ");
                return;

            }
            // Contact validation (assuming it's a 10-digit numeric value)
            var contactRegex = /^\d{10}$/;
            if (contact === '' || !contactRegex.test(contact)) {
                $("#valid_contact").text("Please enter a valid 10-digit contact number.");
                console.log("contact is empty ");
                return;

            }

            // Date of birth validation
          

            // Address validation (assuming it should not be empty)
            if (address === '') {
                $("#valid_address").text("Please enter your address.");
                console.log("address is empty ");
                return;

            }
            if (shipping_address === '') {
                $("#valid_shipping_address").text("Please enter your shipping address.");
                console.log(" shipping address is empty ");
                return;

            }

            // Gender validation
     


            // AJAX request
            $.ajax({
                type: "POST",
                url: "/Profile/UpdateProfile", // Update with your backend endpoint
                data: {
                    lname: lname,
                    fname: fname,
                    email: email, // Added email field
                    contact: contact,
                    address: address,
                    shipping_address: shipping_address,
                    gender: gender
                },
                success: function (response) {
                    // Handle success response
                    console.log(response);
                    alert("succesfully updated...!")
                },
                error: function (xhr, status, error) {
                    // Handle error
                    console.log(error);
                    console.error(xhr.responseText);
                }
            });
        }


        function fetchUserProfile() {
            $.ajax({
                type: 'POST',
                url: '/Profile/fetchUser',
                success: function (userData) {
                    console.log(userData);

                    $('#fname').val(userData['fname']);
                    $('#lname').val(userData['lname']);
                    $('#contact').val(userData['contact']);
                    $('#dob').val(userData['dob']);
                    $('#email').val(userData['email']);
                    $('#shipping_address').val(userData['shipping_address']);
                    $('#address').val(userData['address']);
                    if (userData['gender'] === 'Male') {
                        $('#male').prop('checked', true);
                    } else {
                        $('#female').prop('checked', true);
                    }


                },
                error: function (xhr, status, error) {
                    console.log('Error fetching user data.', error, status, xhr);
                }
            });
        }
    </script>
</body>
</html>